# ğŸ“‚ åˆ†æ¨¡å—è§£é‡Šï¼ˆä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼‰
## 1. bluetoothSlice.ts â€” çŠ¶æ€ç®¡ç†ä¸­å¿ƒï¼ˆæ ¸å¿ƒï¼‰
> ğŸ“Œ "çŠ¶æ€" = å½“å‰è“ç‰™è¿æ¥æƒ…å†µã€è¿æ¥çš„è®¾å¤‡ã€æ¥æ”¶åˆ°çš„æ•°æ®ç­‰ã€‚

```ts
state = {
  status: 'connected',
  device: { id: 'A1:B2:C3:D4' },
  receivedData: [{ id: 1, angle: 45.5 }],
}
```
- âœ… ç»Ÿä¸€ç®¡ç†çŠ¶æ€ï¼ˆä»»ä½•ç»„ä»¶éƒ½å¯ä»¥ç”¨ useSelector è·å–ï¼‰
- âœ… åªè´Ÿè´£ get å’Œ setï¼Œä¸åšå¼‚æ­¥å·¥ä½œ
- âŒ ä¸è´Ÿè´£è¿æ¥è“ç‰™ï¼ˆè¿™æ˜¯å¼‚æ­¥ä»»åŠ¡çš„äº‹ï¼‰

## 2. bluetoothThunks.ts â€” å¼‚æ­¥ä»»åŠ¡ä¸­å¿ƒ
> ğŸ“Œ æ‰€æœ‰ã€Œéœ€è¦ç­‰å¾…ã€çš„ä»»åŠ¡ï¼Œæ¯”å¦‚ï¼š

| ä»»åŠ¡åç§°                         | è¯´æ˜                                        |
| ---------------------------- | ----------------------------------------- |
| `connectToBluetoothDevice()` | åˆå§‹åŒ–ã€æ‰«æã€è¿æ¥è“ç‰™è®¾å¤‡                             |
| `disconnectFromBluetooth()`  | æ–­å¼€è¿æ¥                                      |
| `sendMotorCommand()`         | å‘é€æŒ‡ä»¤åˆ°è®¾å¤‡                                   |
| âœ… âœ… âœ…                        | ä¼šè‡ªåŠ¨æ›´æ–° `slice` é‡Œçš„çŠ¶æ€ï¼Œæ¯”å¦‚ï¼šsetStatus/setDevice |


ğŸ‘‰ æ‰€æœ‰ "è“ç‰™é€»è¾‘" éƒ½åªåœ¨è¿™é‡Œç»Ÿä¸€å¤„ç†ï¼Œä¸åœ¨ Hook é‡Œä¹±å†™ã€‚

## 3. bluetoothTypes.ts â€” ç±»å‹å®šä¹‰ï¼ˆè¾…åŠ©ï¼‰
> ğŸ“Œ ç”¨äºæ˜ç¡®ç»“æ„ï¼Œè®© TypeScript èƒ½æ£€æŸ¥ä½ å†™çš„å†…å®¹æ˜¯å¦æ­£ç¡®ã€‚
```ts
type BluetoothStatus = 'idle' | 'scanning' | 'connecting' | 'connected' | 'error';
```

## 4. bluetoothSelectors.tsï¼ˆå¯é€‰ï¼‰â€” è·å–çŠ¶æ€æ›´æ–¹ä¾¿
> å¦‚æœä½ æœ‰å¤šä¸ªç»„ä»¶éƒ½ç”¨åˆ°è“ç‰™çŠ¶æ€ï¼Œå»ºè®®å°è£…é€‰æ‹©å™¨ï¼š

```ts
export const selectIsConnected = (state: RootState) => state.bluetooth.status === 'connected';
```

## âœ… æœ€ç»ˆä½ èƒ½è·å¾—ä»€ä¹ˆå¥½å¤„ï¼Ÿ
| ä¼˜ç‚¹           | è§£é‡Š                           |
| ------------ | ---------------------------- |
| âœ… å…¨å±€å…±äº«çŠ¶æ€     | æ‰€æœ‰ç»„ä»¶å…±äº«åŒä¸€ä¸ª device/è¿æ¥çŠ¶æ€ï¼Œä¸ä¼šé‡å¤è¿æ¥ |
| âœ… æ¸…æ™°çš„é€»è¾‘åˆ†å±‚    | è¿æ¥é€»è¾‘ã€å‘é€é€»è¾‘ã€çŠ¶æ€é€»è¾‘éƒ½åˆ†å¼€            |
| âœ… æ˜“äºè°ƒè¯•       | çŠ¶æ€é—®é¢˜å¯ç›´æ¥çœ‹ Redux devtoolsï¼Œæ˜“æŸ¥é”™  |
| âœ… æ›´å®¹æ˜“æ‰©å±•      | åæœŸåŠ ä¸Š"è‡ªåŠ¨é‡è¿"ã€"é”™è¯¯æç¤º"ç­‰åŠŸèƒ½æ›´è½»æ¾      |
| âœ… æ›´ç¬¦åˆä¼ä¸šçº§é¡¹ç›®ç»“æ„ | å¦‚æœä»¥åå¤šäººåä½œï¼Œæ›´å®¹æ˜“ç†è§£ä»£ç ç»“æ„           |

## ğŸ”š æ€»ç»“ä¸€å¥è¯ï¼š
> â€œæŠŠèŒè´£åˆ†å¼€ï¼Œèƒ½è®©ä»£ç æ›´ç¨³ã€æ›´å¥½è°ƒã€æ›´ä¸å®¹æ˜“ä¹±â€ã€‚

æˆ‘ä»¬ç”¨ Redux + Slice + Thunk æ˜¯åœ¨å®ç°ã€Œæ¸…æ™°ã€ç¨³å®šã€å¯æ‰©å±•ã€çš„ç°ä»£ React æ¶æ„ã€‚

# ğŸš€ å¦‚ä½•ä½¿ç”¨è“ç‰™æ¨¡å—

## 1. åœ¨ç»„ä»¶ä¸­è¿æ¥è“ç‰™

```tsx
import { useDispatch, useSelector } from 'react-redux';
import { connectToBluetoothDevice } from './bluetoothThunks';
import { selectIsConnected } from './bluetoothSelectors';

const MyComponent = () => {
  const dispatch = useDispatch();
  const isConnected = useSelector(selectIsConnected);

  const handleConnect = async () => {
    try {
      await dispatch(connectToBluetoothDevice()).unwrap();
      console.log('è“ç‰™è¿æ¥æˆåŠŸï¼');
    } catch (error) {
      console.error('è“ç‰™è¿æ¥å¤±è´¥:', error);
    }
  };

  return (
    <Button 
      onPress={handleConnect}
      title={isConnected ? 'å·²è¿æ¥' : 'è¿æ¥è“ç‰™'}
    />
  );
};
```

## 2. å‘é€æŒ‡ä»¤åˆ°è®¾å¤‡

```tsx
import { sendMotorCommand } from './bluetoothThunks';

const ControlPanel = () => {
  const dispatch = useDispatch();

  const handleSendCommand = async (angle: number) => {
    try {
      await dispatch(sendMotorCommand({ angle })).unwrap();
      console.log('æŒ‡ä»¤å‘é€æˆåŠŸï¼');
    } catch (error) {
      console.error('æŒ‡ä»¤å‘é€å¤±è´¥:', error);
    }
  };

  return (
    <Button 
      onPress={() => handleSendCommand(45)}
      title="æ—‹è½¬45åº¦"
    />
  );
};
```

## 3. ç›‘å¬è“ç‰™çŠ¶æ€

```tsx
import { useSelector } from 'react-redux';
import { selectBluetoothStatus, selectReceivedData } from './bluetoothSelectors';

const StatusMonitor = () => {
  const status = useSelector(selectBluetoothStatus);
  const receivedData = useSelector(selectReceivedData);

  return (
    <View>
      <Text>çŠ¶æ€: {status}</Text>
      <Text>æ¥æ”¶åˆ°çš„æ•°æ®: {JSON.stringify(receivedData)}</Text>
    </View>
  );
};
```

## 4. é”™è¯¯å¤„ç†

```tsx
import { useSelector } from 'react-redux';
import { selectBluetoothError } from './bluetoothSelectors';

const ErrorHandler = () => {
  const error = useSelector(selectBluetoothError);

  useEffect(() => {
    if (error) {
      Alert.alert('è“ç‰™é”™è¯¯', error.message);
    }
  }, [error]);

  return null;
};
```

## 5. è‡ªåŠ¨é‡è¿ç¤ºä¾‹

```tsx
import { useEffect } from 'react';
import { useDispatch, useSelector } from 'react-redux';
import { connectToBluetoothDevice } from './bluetoothThunks';
import { selectIsConnected } from './bluetoothSelectors';

const AutoReconnect = () => {
  const dispatch = useDispatch();
  const isConnected = useSelector(selectIsConnected);

  useEffect(() => {
    let reconnectTimer: NodeJS.Timeout;

    if (!isConnected) {
      reconnectTimer = setInterval(() => {
        dispatch(connectToBluetoothDevice());
      }, 5000); // æ¯5ç§’å°è¯•é‡è¿
    }

    return () => {
      if (reconnectTimer) {
        clearInterval(reconnectTimer);
      }
    };
  }, [isConnected, dispatch]);

  return null;
};
```

ä»¥ä¸Šç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨è“ç‰™æ¨¡å—çš„ä¸»è¦åŠŸèƒ½ã€‚ä½ å¯ä»¥æ ¹æ®éœ€è¦ç»„åˆè¿™äº›ç»„ä»¶ï¼Œæ„å»ºå®Œæ•´çš„è“ç‰™æ§åˆ¶ç•Œé¢ã€‚è®°ä½å§‹ç»ˆä½¿ç”¨ Redux çš„å¼‚æ­¥ action æ¥å¤„ç†è“ç‰™æ“ä½œï¼Œä¿æŒä»£ç ç»“æ„çš„æ¸…æ™°å’Œç»Ÿä¸€ã€‚